import{d as ue,u as Ce,r as i,c as C,a as te,o as xe,g as K,b as Q,e as ke,f as Ve,w as de,h as v,i as g,j as d,k as s,l as r,_ as X,m as H,n as De,p as se,t as b,F as A,q as Z,s as oe,v as c,x as I,y as Pe,z as Me,A as J,B as ve,C as Se,D as Be,E as pe,G as $e,H as Ge,I as ie,J as Ie,K as He,L as Le,M as Oe,N as he,O as ge,P as fe,Q as me,R as Ae,S as Fe,T as je,U as Ne,V as Ue,W as re,X as ce,Y as _e,Z as Ye,$ as M}from"./index.293d8672.js";const F=f=>(ge("data-v-7a94bc56"),f=f(),fe(),f),Re={class:"modal fade fixed top-0 left-0 hidden w-full h-full outline-none overflow-x-hidden overflow-y-auto","data-bs-backdrop":"static",ref:"el_refer_modal",id:"referModal","aria-labelledby":"exampleModalLgLabel","aria-modal":"true",role:"dialog"},Ee={class:"modal-dialog modal-md relative w-auto pointer-events-none border-4 border-indigo-500/100"},Te={class:"modal-content border-none shadow-sm relative flex flex-col w-full pointer-events-auto bg-white bg-clip-padding rounded-md outline-none text-current"},We=F(()=>d("div",{class:"modal-header flex flex-shrink-0 items-center justify-between p-4 border-b border-gray-200 rounded-t-md"},[d("h5",{class:"text-xl font-medium leading-normal text-gray-800",id:"exampleModalLgLabel"}," Refer Patient "),d("button",{type:"button",class:"btn-close box-content w-4 h-4 p-1 text-black border-none rounded-none opacity-50 focus:shadow-none focus:outline-none focus:opacity-100 hover:text-black hover:opacity-75 hover:no-underline","data-bs-dismiss":"modal","aria-label":"Close"})],-1)),qe={class:"modal-body relative p-4"},Je={key:0,class:"p-3 bg-gray-100/50 dark:bg-slate-800"},ze={key:1},Ke=F(()=>d("thead",null,[d("tr",null,[d("th",null,"Name"),d("th",null,"Municipality"),d("th",null,"Barangay"),d("th",null,"Created"),d("th")])],-1)),Qe={"data-label":"Name"},Xe={"data-label":"Municipality"},Ze={"data-label":"Barangay"},ea={"data-label":"Created",class:"lg:w-1 whitespace-nowrap"},aa=["title"],la=F(()=>d("br",null,null,-1)),na={class:"text-gray-400 dark:text-slate-400"},ta={class:"before:hidden lg:w-1 whitespace-nowrap"},da=F(()=>d("b",null,"Info state",-1)),sa={key:3,class:"flex flex-row mt-2 p-10"},oa=["src"],ia=F(()=>d("p",{class:"text-xl ml-2"},"Processing...",-1)),ra={key:4,class:"p-3 lg:px-6 border-t border-gray-100 dark:border-slate-800"},ca=ue({__name:"TableClients",props:{checkable:Boolean,search_keyword:{type:String,default:null},form:{type:Object,default:null}},emits:["client-info","client-data"],setup(f,{emit:x}){const L=f,k=Ce(),u=i([]),V=i([]),O=C(()=>u.value),j=i(!1),S=i(!1),B=i(10),m=i(0),$=i([]),y=te({client_id:0,client_name:""}),D=C(()=>O.value.slice(B.value*m.value,B.value*(m.value+1))),N=C(()=>Math.ceil(O.value.length/B.value)),U=C(()=>m.value+1),z=C(()=>{const t=[];for(let l=0;l<N.value;l++)t.push(l);return t});te({name:"John Doe",email:"john.doe@example.com",phone:"",barangay:[{id:1,label:"Lahug"},{id:2,label:"Sambag II"},{id:3,label:"Day-as"}][0],subject:"",question:""});const w=i(0),_=i(0),e=i([]),P=i([]);xe(()=>{R(),E(),Y()});const Y=async(t={})=>{if(!t.search){const o=await K({userid:Q().value});t={barangay_assignment:await Promise.all(o.map(async p=>p.id))}}const l=await ke(t);u.value=await Promise.all(l.map(async o=>({...o,sex:o.sex.charAt(0).toUpperCase()+o.sex.slice(1),fullname:o.firstname+" "+o.middlename+" "+o.lastname}))),V.value=u.value,x("client-data",u.value)},R=async()=>{const t=await K({userid:Q().value});e.value=await Promise.all(t.map(async l=>({id:l.id,label:l.description})))},E=async()=>{const t=await K({userid:Q().value}),l=await Promise.all(t.map(async p=>p.id)),o=await Ve(),h=await Promise.all(o.map(async p=>{if(!l.includes(p.id))return{id:p.id,label:p.description}}));P.value=h.filter(p=>typeof p=="object")},T=async(t,l)=>{y.client_id=t,y.client_name=l,S.value=!0},W=async()=>{u.value=u.value.filter(t=>t.id!==y.client_id),await Ge({id:y.client_id}),ie({group:"error",title:"Warning",text:y.client_name+" was successfully deleted"},2e3)},q=t=>{x("client-info",t)},n=C(()=>L.search_keyword);de(n,t=>{console.log("search keyword");let l=V.value.filter(o=>o.fullname.toLowerCase().includes(t.toLowerCase()));l.length>0?(u.value=l,m.value=0):u.value=[]});const be=C(()=>L.form);de(be,t=>{t.status=="updated"?u.value.filter(l=>{l.id==t.id&&(l.firstname=t.firstname,l.middlename=t.middlename,l.lastname=t.lastname,l.client_barangay=t.client_barangay,l.muncity_description=t.muncity_description,l.fullname=t.firstname+" "+t.middlename+" "+t.lastname)}):(u.value.unshift(t),L.search_keyword&&V.value.unshift(t))});const G=i(""),ae=async()=>{var p;const t=e.value.filter(a=>a.id===w.value),l=P.value.filter(a=>a.id===_.value),o={Client:[le.value.id],client_id:le.value.id,code:I().format("YYYY")+"-"+k.userId+I().format("MMDDHHmmss")+String(Math.random()).substring(0,3).split(".").join(""),date_referred:I().format("YYYY-MM-DD HH:mm:ss"),referred_from:w.value,referred_from_address:t[0].label,referred_to:_.value,referred_to_address:l[0].label,referring_id:k.userId,referring_name:k.userFirstname+" "+k.userMiddlename+" "+k.userLastname,remarks:G.value,status:"referred",created_on:I().format("YYYY-MM-DD HH:mm:ss")},h=await Ie(o);o.Activity=[h.id],await He(o),(p=refer_modal.value)==null||p.hide(),ie({group:"success",title:"success",text:"Client was successfully referred!"},2e3),G.value=""},le=i({}),ye=i([]),we=C(()=>ye.value.indexOf("outline")>-1);return(t,l)=>{const o=Le,h=Oe,p=he;return v(),g(A,null,[d("div",Re,[d("div",Ee,[d("div",Te,[We,d("div",qe,[s(p,{"is-form":"",onSubmit:De(ae,["prevent"])},{default:r(()=>[s(h,{label:"Referring Facility",class:"mt-6"},{default:r(()=>[s(o,{modelValue:w.value,"onUpdate:modelValue":l[0]||(l[0]=a=>w.value=a),options:e.value},null,8,["modelValue","options"])]),_:1}),s(h,{label:"Referred Facility",class:"mt-6"},{default:r(()=>[s(o,{modelValue:_.value,"onUpdate:modelValue":l[1]||(l[1]=a=>_.value=a),options:P.value},null,8,["modelValue","options"])]),_:1}),s(h,{label:"Remarks"},{default:r(()=>[s(o,{modelValue:G.value,"onUpdate:modelValue":l[2]||(l[2]=a=>G.value=a),type:"textarea"},null,8,["modelValue"])]),_:1}),s(X,null,{default:r(()=>[s(H,{type:"submit",color:"success",label:"Refer"}),s(H,{type:"button",color:"info",outline:"",label:"Close","data-bs-dismiss":"modal"})]),_:1})]),_:1},8,["onSubmit"])])])])],512),s(se,{modelValue:j.value,"onUpdate:modelValue":l[6]||(l[6]=a=>j.value=a),title:"Refer Client",button:"success","has-cancel":"","has-refer":"",onRefer:ae},{default:r(()=>[s(h,{label:"Referring Facility",class:"mt-6"},{default:r(()=>[s(o,{modelValue:w.value,"onUpdate:modelValue":l[3]||(l[3]=a=>w.value=a),options:e.value},null,8,["modelValue","options"])]),_:1}),s(h,{label:"Referred Facility",class:"mt-6"},{default:r(()=>[s(o,{modelValue:_.value,"onUpdate:modelValue":l[4]||(l[4]=a=>_.value=a),options:P.value},null,8,["modelValue","options"])]),_:1}),s(h,{label:"Remarks"},{default:r(()=>[s(o,{modelValue:G.value,"onUpdate:modelValue":l[5]||(l[5]=a=>G.value=a),type:"textarea"},null,8,["modelValue"])]),_:1})]),_:1},8,["modelValue"]),s(se,{modelValue:S.value,"onUpdate:modelValue":l[7]||(l[7]=a=>S.value=a),button:"danger","has-cancel":"","has-confirm":"",title:".",onConfirmDelete:W},{default:r(()=>[d("p",null,"Are you sure you want to delete "+b(y.client_name)+"?",1)]),_:1},8,["modelValue"]),$.value.length?(v(),g("div",Je,[(v(!0),g(A,null,Z($.value,a=>(v(),g("span",{key:a.id,class:"inline-block px-2 py-1 rounded-sm mr-2 text-sm bg-gray-100 dark:bg-slate-700"},b(a.firstname+" "+a.middlename+" "+a.lastname),1))),128))])):oe("",!0),c(D).length>0?(v(),g("table",ze,[Ke,d("tbody",null,[(v(!0),g(A,null,Z(c(D),a=>(v(),g("tr",{key:a.id},[d("td",Qe,b(a.fullname),1),d("td",Xe,b(a.muncity_description),1),d("td",Ze,b(a.client_barangay),1),d("td",ea,[d("small",{class:"text-gray-500 dark:text-slate-400",title:a.created_on},b(c(I)(a.created_on).format("ll")),9,aa),la,d("small",na,b(c(I)(a.created_on).format("h:mm:ss a")),1)]),d("td",ta,[s(X,{type:"justify-start lg:justify-end","no-wrap":""},{default:r(()=>[s(H,{color:"info",icon:c(Pe),small:"",onClick:ne=>q(a.id)},null,8,["icon","onClick"]),s(H,{color:"danger",icon:c(Me),small:"",onClick:ne=>T(a.id,a.firstname+" "+a.middlename+" "+a.lastname)},null,8,["icon","onClick"])]),_:2},1024)])]))),128))])])):u.value.length<=0&&c(n)?(v(),J(Be,{key:2,color:"info",icon:c(Se),outline:c(we)},{default:r(()=>[da,ve(". No client found! ")]),_:1},8,["icon","outline"])):(v(),g("div",sa,[d("img",{src:c(pe),alt:"loading_gif",class:"w-10 h-10"},null,8,oa),ia])),u.value.length>0?(v(),g("div",ra,[s($e,null,{default:r(()=>[s(X,null,{default:r(()=>[(v(!0),g(A,null,Z(c(z),a=>(v(),J(H,{key:a,active:a===m.value,label:a+1,color:a===m.value?"lightDark":"whiteDark",small:"",onClick:ne=>m.value=a},null,8,["active","label","color","onClick"]))),128))]),_:1}),d("small",null,"Page "+b(c(U))+" of "+b(c(N)),1)]),_:1})])):oe("",!0)],64)}}});const _a=me(ca,[["__scopeId","data-v-7a94bc56"]]),ua=f=>(ge("data-v-4476bfbe"),f=f(),fe(),f),va={class:"flex gap-4"},pa={class:"md:block"},ha={class:"flex flex-row"},ga=ua(()=>d("p",{class:"text-sm"},"Processing",-1)),fa=["src"],ma=ue({__name:"ClientView",emits:["loading-modal-open","loading-modal-close"],setup(f,{emit:x}){const L=()=>{x("loading-modal-open")},k=()=>{x("loading-modal-close")},u=i({"Vaccine ID":"vaccine_id",Fullname:"fullname","Birth Date":"birthdate","Birth Place":"birthplace",Sex:"sex","Guardian Name":"guardian_name","Guardian Contact #":"guardian_contact_number","Guardian Alternate Number":"guardian_alternate_number","Guardian Address":"guardian_barangay","BHW Name":"bhw_name","BHW Contact #":"bhw_contact_number","BHW Address":"bhw_barangay","Health Provider Name":"health_provider_name","Health Provider Contact #":"health_provider_contact","Health Provider Address":"health_provider_barangay",Municipality:"muncity_description",Barangay:"client_barangay","Created On":"created_on",BCG:"bcg","BCG Date Scheduled":"bcg_date_scheduled","BCG Date Given":"bcg_date_given",HepB:"hepb","HepB Date Scheduled":"hepb_date_scheduled","HepB Date Given":"hepb_date_given",IPV:"ipv","IPV Date Scheduled":"ipv_date_scheduled","IPV Date Given":"ipv_date_given",MCV:"mcv","MCV Date Scheduled1":"mcv_date_scheduled1","MCV Date Given1":"mcv_date_given1","MCV Date Scheduled2":"mcv_date_scheduled2","MCV Date Given2":"mcv_date_given2",Pentavalent:"pentavalent","Pentavalent Date Scheduled1":"pentavalent_date_scheduled1","Pentavalent Date Given1":"pentavalent_date_given1","Pentavalent Date Scheduled2":"pentavalent_date_scheduled2","Pentavalent Date Given2":"pentavalent_date_given2","Pentavalent Date Scheduled3":"pentavalent_date_scheduled3","Pentavalent Date Given3":"pentavalent_date_given3",OPV:"opv","OPV Date Scheduled1":"opv_date_scheduled1","OPV Date Given1":"opv_date_given1","OPV Date Scheduled2":"opv_date_scheduled2","OPV Date Given2":"opv_date_given2","OPV Date Scheduled3":"opv_date_scheduled3","OPV Date Given3":"opv_date_given3",PCV:"pcv","PCV Date Scheduled1":"pcv_date_scheduled1","PCV Date Given1":"pcv_date_given1","PCV Date Scheduled2":"pcv_date_scheduled2","PCV Date Given2":"pcv_date_given2","PCV Date Scheduled3":"pcv_date_scheduled3","PCV Date Given3":"pcv_date_given3"}),V=i(!0),O=i([]),j=async _=>{O.value=_,V.value=!1},S=async()=>{if(V.value){alert("Some data are still processing in excel, please wait for a while.");return}return await Promise.all(O.value.map(async e=>{const P=await M({client_id:e.id,vaccine_type:"bcg"}),Y=await M({client_id:e.id,vaccine_type:"hepb"}),R=await M({client_id:e.id,vaccine_type:"ipv"}),E=await M({client_id:e.id,vaccine_type:"mcv"}),T=await M({client_id:e.id,vaccine_type:"pentavalent"}),W=await M({client_id:e.id,vaccine_type:"opv"}),q=await M({client_id:e.id,vaccine_type:"pcv"});if(P.length>0){const n=P[0];e.bcg="active",e.bcg_date_scheduled=n.scheduled_1,e.bcg_date_given=n.given_1}else e.bcg="",e.bcg_date_scheduled="",e.bcg_administerred_schedule="",e.bcg_date_given="",e.bcg_administerred_given="";if(Y.length>0){const n=Y[0];e.hepb="active",e.hepb_date_scheduled=n.scheduled_1,e.hepb_date_given=n.given_1}else e.hepb="",e.hepb_date_scheduled="",e.hepb_administerred_schedule="",e.hepb_date_given="",e.hepb_administerred_given="";if(R.length>0){const n=R[0];e.ipv="active",e.ipv_date_scheduled=n.scheduled_1,e.ipv_date_given=n.given_1}else e.ipv="",e.ipv_date_scheduled="",e.ipv_administerred_schedule="",e.ipv_date_given="",e.ipv_administerred_given="";if(E.length>0){const n=E[0];e.mcv="active",e.mcv_date_scheduled1=n.scheduled_1,e.mcv_date_given1=n.given_1,e.mcv_date_scheduled2=n.scheduled_2,e.mcv_date_given2=n.given_2}else e.mcv="",e.mcv_date_scheduled1="",e.mcv_administerred_schedule1="",e.mcv_date_given1="",e.mcv_administerred_given1="",e.mcv_date_scheduled2="",e.mcv_administerred_schedule2="",e.mcv_date_given2="",e.mcv_administerred_given2="";if(T.length>0){const n=T[0];e.pentavalent="active",e.pentavalent_date_scheduled1=n.scheduled_1,e.pentavalent_date_given1=n.given_1,e.pentavalent_date_scheduled2=n.scheduled_2,e.pentavalent_date_given2=n.given_2,e.pentavalent_date_scheduled3=n.scheduled_3,e.pentavalent_date_given3=n.given_3}else e.pentavalent="",e.pentavalent_date_scheduled1="",e.pentavalent_administerred_schedule1="",e.pentavalent_date_given1="",e.pentavalent_administerred_given1="",e.pentavalent_date_scheduled2="",e.pentavalent_administerred_schedule2="",e.pentavalent_date_given2="",e.pentavalent_administerred_given2="",e.pentavalent_date_scheduled3="",e.pentavalent_administerred_schedule3="",e.pentavalent_date_given3="",e.pentavalent_administerred_given3="";if(W.length>0){const n=W[0];e.opv="active",e.opv_date_scheduled1=n.scheduled_1,e.opv_date_given1=n.given_1,e.opv_date_scheduled2=n.scheduled_2,e.opv_date_given2=n.given_2,e.opv_date_scheduled3=n.scheduled_3,e.opv_date_given3=n.given_3}else e.opv="",e.opv_date_scheduled1="",e.opv_administerred_schedule1="",e.opv_date_given1="",e.opv_administerred_given1="",e.opv_date_scheduled2="",e.opv_administerred_schedule2="",e.opv_date_given2="",e.opv_administerred_given2="",e.opv_date_scheduled3="",e.opv_administerred_schedule3="",e.opv_date_given3="",e.opv_administerred_given3="";if(q.length>0){const n=q[0];e.pcv="active",e.pcv_date_scheduled1=n.scheduled_1,e.pcv_date_given1=n.given_1,e.pcv_date_scheduled2=n.scheduled_2,e.pcv_date_given2=n.given_2,e.pcv_date_scheduled3=n.scheduled_3,e.pcv_date_given3=n.given_3}else e.pcv="",e.pcv_date_scheduled1="",e.pcv_administerred_schedule1="",e.pcv_date_given1="",e.pcv_administerred_given1="",e.pcv_date_scheduled2="",e.pcv_administerred_schedule2="",e.pcv_date_given2="",e.pcv_administerred_given2="",e.pcv_date_scheduled3="",e.pcv_administerred_schedule3="",e.pcv_date_given3="",e.pcv_administerred_given3="";return{...e}}))},B=i(""),m=async _=>{B.value=_},$=i(!1),y=()=>{$.value=!$.value},D=i({flag:!1,id:0}),N=_=>{D.value.id=_,D.value.flag=!D.value.flag},U=i({}),z=_=>{console.log(_),U.value=_},ee=()=>{x("loading-modal-open")},w=()=>{x("loading-modal-close")};return(_,e)=>(v(),g(A,null,[s(Ae,{onSearchClient:m},{default:r(()=>[s(je,{class:"mt-8 lg:mt-0"},{default:r(()=>[s(Ne,{icon:c(Ue),title:"Clients for new born baby",main:""},{default:r(()=>[d("div",va,[d("div",pa,[V.value?(v(),J(c(_e),{key:0,class:"inline-flex justify-center items-center whitespace-nowrap focus:outline-none transition-colors focus:ring duration-150 border cursor-pointer rounded border-yellow-600 dark:border-yellow-500 ring-yellow-300 dark:ring-yellow-700 bg-yellow-600 dark:bg-yellow-500 text-white hover:bg-yellow-700 hover:border-yellow-700 hover:dark:bg-yellow-600 hover:dark:border-yellow-600 py-2 px-3",fetch:S,fields:u.value,worksheet:"Vaccinated",name:"vaccinated.xls"},{default:r(()=>[s(re,{path:c(ce)},null,8,["path"]),d("div",ha,[ga,d("img",{src:c(pe),alt:"loading_gif",class:"ml-2 w-4 h-4"},null,8,fa)])]),_:1},8,["fields"])):(v(),J(c(_e),{key:1,class:"w-full md:w-40 inline-flex justify-center items-center whitespace-nowrap focus:outline-none transition-colors focus:ring duration-150 border cursor-pointer rounded border-yellow-600 dark:border-yellow-500 ring-yellow-300 dark:ring-yellow-700 bg-yellow-600 dark:bg-yellow-500 text-white hover:bg-yellow-700 hover:border-yellow-700 hover:dark:bg-yellow-600 hover:dark:border-yellow-600 py-2 px-3",fetch:S,fields:u.value,"before-generate":L,"before-finish":k,worksheet:"Clients",name:"clients.xls"},{default:r(()=>[s(re,{path:c(ce)},null,8,["path"]),ve(" Download Excel ")]),_:1},8,["fields"])),s(H,{class:"w-full md:w-40",onClick:y,type:"button",color:"info",label:"Create",icon:c(Ye)},null,8,["icon"])])])]),_:1},8,["icon"]),s(he,{class:"mb-6","has-table":""},{default:r(()=>[s(_a,{onClientInfo:N,onClientData:j,search_keyword:B.value,form:U.value,checkable:""},null,8,["search_keyword","form"])]),_:1})]),_:1})]),_:1}),s(Fe,{createClient:$.value,updateClientModal:D.value,onPropsForm:z,onLoadingModalOpen:ee,onLoadingModalClose:w},null,8,["createClient","updateClientModal"])],64))}});const ya=me(ma,[["__scopeId","data-v-4476bfbe"]]);export{ya as default};
